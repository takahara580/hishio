<div class="container">
  <div class="row py-5">
    <%= render 'public/genres/genre' %>
    <div class="col-9 col-md-9 mt-4 mx-auto">
      <div class="row">
        <div class="col-12 col-md-6">
          <div class="d-flex justify-content-center">
            <%= image_tag @item.get_item_image(300,300), class: 'item_image' %>
          </div>
        </div>
        <div class="col-12 col-md-6 align-self-center">
          <h3 class="mb-3"><%= @item.name %></h3>
          <h5 class="mb-5"><%= @item.text %></h5>
          <div id="favorite_buttons_<%= @item.id %>"><%= render "public/favorites/btn", item: @item %></div>
          <div class="d-flex align-items-center mb-4">
            <% if @item.is_active == true %>
              <h5 class="mb-0">¥<%= @item.non_taxed_price %></h5>
              <small class="ml-2">(税込)</small>
            <% else %>
              <h5 class='text-danger'>販売停止中</h5>
            <% end %>
            <% if customer_signed_in? %>
              <%= form_with model: @cart_item, local: true do |f| %>
                <%= f.hidden_field :item_id, value: @item.id %>
                <% if @item.is_active == true %>
                  <%= f.select :amount, *[1 ... 100], placeholder: "個数選択" %>
                  <%= f.submit 'カートに入れる', class: 'btn btn-success ml-5' %>
                <% end %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="col-8 text-center mx-auto mt-5">
          <% if current_customer %>
            <div>
              <%= form_with model: [@item, @item_comment], url: item_item_comments_path(@item) do |f| %>
                <%= f.text_field :comment, rows: '5', class: 'form-control', placeholder: "コメントをここに" %>
                <%= f.submit "送信する" %>
              <% end %>
            </div>
          <% else %>
            <p>コメントを投稿するにはログインが必要です。</p>
          <% end %>
        </div>
        <div class="col-8 mx-auto">
          <div>
            <p>コメント件数：<%= @item.item_comments.count %></p>
            <div class="d-flex flex-column" style="height: 200px;">
              <% @item.item_comments.each do |item_comment| %>
                <p>
                  <%= item_comment.customer.last_name %>　<%= item_comment.customer.first_name %>
                  <%= item_comment.created_at.strftime('%Y/%m/%d') %>
                </p>
                <%= item_comment.comment %>

                <% if item_comment.customer == current_customer %>
                  <%= link_to "削除", item_item_comment_path(@item, item_comment), class: 'text-right', method: :delete %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>